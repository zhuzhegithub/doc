
nginx.conf配置文件配置说明

全局配置项	主要功能	    配置说明
user	配置nginx用户	直接使用root操作nginx可以不配置
worker_processes	开启的nginx进程数	一般根据自己服务器内核数的1~2倍设置
error_log	日志文件存放的地方	需要查看日志的才需要去配置
pid	存放nginx进程pid的地方
worker_connections	单个进程允许的最大并发连接数	根据服务器性能配置
upstream	nginx负载均衡配置	具体配置如下
http	web服务器配置	具体配置项如下


http(s)配置项	值	配置说明
gzip	on/off	是否打开gzip压缩，具体gzip压缩下面详述
server	虚拟主机的web服务配置	具体配置见下面负载均衡和反向代理
listen	80/443	监听服务器实体主机的访问端口
server_name	域名	可以访问到这台主机的域名
location		server代理的内部服务或者其他域的服务

负载均衡配置
upstream <命名，eg:backend_test> {
        #ip_hash;   # 当负载两台以上用ip来hash解决session的问题
        server 192.168.10.100:8080 max_fails=2 fail_timeout=30s ;
        server 192.168.10.101:8080 max_fails=2 fail_timeout=30s ;
    }

    # server段配合负载均衡的设置
    server {
        listen       80;
        server_name  www.aliyuntest.com;    #要访问的域名，这里用的测试域名，如果有多个，用逗号分开
        charset utf8;
        location / {
            proxy_pass       http://backend_test;    #这里backend_test是上面的负载的名称，映射到代理服务器
            proxy_set_header Host      $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }
    }


反向代理配置
server {
        listen       80;
        server_name  app.aliyuntest.com;    #反向代理到另一个域名（可以使同一个域名下的多个二级域名）
        charset utf8;
            #charset koi8-r;
            #access_log  logs/host.access.log  main;
            location / {    # 这里的 / 表示的是访问的 app.aliyuntest.com/
                proxy_pass       http://110.110.110.110:8000; #这里可以填本机开启的服务，也可以填其他机器开启的服务，格式http://Ip:port或者http://域名:port  （端口为80的不用写，为443的也不写，但要把http改为https）
                proxy_set_header Host      $host;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }
    }

gzip 压缩
 gzip  on;   # 开启gzip压缩
 gzip_min_length 1k;     # 压缩的临界值，大于1K的才压缩
 gzip_buffers 4 512k;    # gzip压缩的内存大小
 #gzip_http_version 1.0;     # 用了nginx反向代理的默认是http/1.1，需要http:/1.0的取消注释
 gzip_comp_level 6;      # 压缩级别，越大压缩的越小，服务器压力越大
 gzip_types text/plain application/x-javascript text/css application/xml text/javascript application/x-httpd-php image/jpeg image/gif image/png application/javascript;  # 压缩文件格式，浏览器-控制台-network-http请求的Respose-Headers中查看content-type字段
 gzip_vary off;
 gzip_disable "MSIE [1-6]\.";    # IE6不使用gzip压缩

 # 检测gzip是否开启成功
     curl -I -H "Accept-Encoding: gzip, deflate" "http://域名/路由"



